---
title: Use Multiple CPU Cores
slug: /docs/use-multiple-cpu-cores
tags: [versioning]
sidebar_label: üçÉ ‚ÄÖUse Multiple Cores
id: use-multiple-cpu-cores
pagination_next: null
pagination_prev: null
description: How can I use multiple CPU cores inside of Metaflow tasks?
category: data science
hide_table_of_contents: false
---


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! Instead, edit the notebook w/the location & name as this file. -->

## Question
How can I use multiple CPU cores within Metaflow tasks?

## Answer
You can use multiple cores like you normally would in your Python code in a Metaflow task. 
For example, you can use Python's [concurrent.future](https://docs.python.org/3/library/concurrent.futures.html) module to launch multiple processes and threads.



### <NumberHeading number={1}>Write Flow with Concurrency in a Task</NumberHeading>




This flow shows how to:
- Call the `do_task` function four times on different cores using Python's built-in `concurrent.futures.ThreadPoolExecutor`. 
- Print the total time elapsed to demonstrate the tasks ran in parallel.







```py title="use_multiple_cpu_cores.py"
from metaflow import FlowSpec, step, Parameter
from concurrent import futures
import time

def do_task(name):
    time.sleep(3) # a long-running task
    return name

class MulticoreFlow(FlowSpec):

    #highlight-next-line
    num_cores = Parameter('num-cores', default=4)

    @step
    def start(self):
        threads = [
            "thread_%s" % i 
            for i in range(self.num_cores)
        ]
        t0 = time.time()
        #highlight-start
        with futures.ThreadPoolExecutor(
            max_workers = self.num_cores
        ) as exe:
            self.messages = [
                msg for msg in exe.map(do_task, threads)
            ]
        #highlight-end
        self.time_elapsed = time.time() - t0
        self.next(self.end)

    @step
    def end(self):
        print_msg = "All tasks completed in %.3fs"
        print(print_msg % self.time_elapsed)
        [print(msg) for msg in self.messages]

if __name__ == '__main__':
    MulticoreFlow()
```



### <NumberHeading number={2}>Run Flow</NumberHeading>



```bash
python use_multiple_cpu_cores.py run
```

<CodeOutputBlock lang="bash">

```
     Workflow starting (run-id 1663278003721691):
     [1663278003721691/start/1 (pid 47937)] Task is starting.
     [1663278003721691/start/1 (pid 47937)] Task finished successfully.
     [1663278003721691/end/2 (pid 47941)] Task is starting.
     [1663278003721691/end/2 (pid 47941)] All tasks completed in 3.011s
     [1663278003721691/end/2 (pid 47941)] thread_0
     [1663278003721691/end/2 (pid 47941)] thread_1
     [1663278003721691/end/2 (pid 47941)] thread_2
     [1663278003721691/end/2 (pid 47941)] thread_3
     [1663278003721691/end/2 (pid 47941)] Task finished successfully.
     Done!
```

</CodeOutputBlock>




## Further Reading
* [Parallelization Over Multiple Cores](https://docs.metaflow.org/metaflow/scaling-out-and-up/effortless-scaling-with-kubernetes#parallelization-over-multiple-cores)
* [How to Scale Model Training and Tuning to GPU](/docs/scale-model-training-and-tuning/)
